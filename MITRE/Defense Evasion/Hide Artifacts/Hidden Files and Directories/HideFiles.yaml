---
- apiVersion: security.accuknox.com/v1
- kind: KubeArmorPolicy
- metadata:
  name: mitre-tactic-defense-evasion-hide-artifacts
- macro: rename
  condition: evt.type in (rename, renameat, renameat2)
- macro: mkdir
  condition: evt.type in (mkdir, mkdirat)
- macro: remove
  condition: evt.type in (rmdir, unlink, unlinkat)
- macro: modify
  condition: rename or remove
- spec:
  selectorLabels:
      nodeSelector:
          hostname: xyz
  condition: >
    ((modify and evt.arg.newpath contains "/.") or
     (mkdir and evt.arg.path contains "/.") or
     (open_write and evt.arg.flags contains "O_CREAT" and fd.name contains "/."
  output: >
    Hidden file or directory created
    (user=%user.name user_loginuid=%user.loginuid
    command=%proc.cmdline file=%fd.name newpath=%evt.arg.newpath
    container_id=%container.id container_name=%container.name
    image=%container.image.repository:%container.image.tag)
  action: Audit
  severity: 2
